# 200刀太贵，我决定研究 Claude Code（四）API 篇：OpenAI 格式转换实战

1. 引言部分
这一章节主要阐述我们要做什么，以及引导读者对于阅读这篇blog的兴趣。

在上一篇中，我们对Claude 的 API 进行了深度解析。
那么解析来就来实现对于与OpenAI之间的格式转换。

然后是一张流程图，Claude的请求 -> OpenAI的请求 -> OpenAI格式的LLM供应商 -> Claude的响应。

2. 任务拆解
这一章节，我们首先将我们的目标进行拆解。
首先是大的任务拆解：
1. 请求
2. 响应
3. 流式响应

然后再是对于请求的任务拆解：
1. 基础配置的映射
2. 工具定义转换
3. 消息序列构建

其中消息序列构建比较复杂，因为设计到了多种不同的内容类型，而不同的内容类型会有一些区别
1. system，这个比较特殊，在Claude中是在消息序列之外，算是基础配置的一部分，在OpenAI的格式中属于消息序列
2. text，这是最常见的
3. iamge，多模态的支持，目前Cluaude只支持图片，因此我们只需要实现图片的转换
4. thinking，响应内容快，需要支持
5. tool_use，LLM的工具调用请求
6. tool_result，LLM的工具执行结果

3. 实现篇
3.1 系统提示词转换
实际上对于
